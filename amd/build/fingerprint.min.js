define("local_agentdetect/fingerprint",["exports"],(function(_exports){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=_exports.collect=void 0;
/**
   * Technical fingerprinting module for agent detection.
   *
   * Collects browser fingerprint data to identify automation tools,
   * headless browsers, and known AI/automation extensions.
   *
   * @module     local_agentdetect/fingerprint
   * @copyright  2024 Your Institution
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */
const COMET_EXTENSION_ID="npclhjbddhklpbnacpjloidibaggcgon",COMET_RESOURCE_PATHS=["icon.png","icons/icon128.png","icons/icon48.png","overlay.js"],initialWebdriverState=navigator.webdriver,KNOWN_EXTENSIONS=[{id:COMET_EXTENSION_ID,name:"Comet Agent (Perplexity)",weight:10,pattern:/comet.*agent|perplexity/i},{id:"claudeinchrome",name:"Claude in Chrome (MCP)",weight:10,pattern:/claude.*mcp|mcp.*claude/i},{id:"anthropic",name:"Anthropic Browser Agent",weight:10,pattern:/anthropic/i},{id:"undetectable",name:"Undetectable.ai",weight:9,pattern:/undetectable/i},{id:"gofingerprint",name:"GoLogin Fingerprint",weight:8,pattern:/gologin/i},{id:"multilogin",name:"MultiLogin",weight:8,pattern:/multilogin/i},{id:"selenium",name:"Selenium IDE",weight:10,pattern:/selenium/i},{id:"puppeteer",name:"Puppeteer Recorder",weight:9,pattern:/puppeteer/i},{id:"playwright",name:"Playwright Inspector",weight:9,pattern:/playwright/i},{id:"imacros",name:"iMacros",weight:8,pattern:/imacros/i},{id:"browserflow",name:"Browserflow",weight:8,pattern:/browserflow/i},{id:"axiom",name:"Axiom.ai",weight:8,pattern:/axiom/i},{id:"browseai",name:"Browse AI",weight:8,pattern:/browse.*ai/i},{id:"bardeen",name:"Bardeen",weight:7,pattern:/bardeen/i},{id:"tampermonkey",name:"Tampermonkey",weight:5,pattern:/tampermonkey/i},{id:"greasemonkey",name:"Greasemonkey",weight:5,pattern:/greasemonkey/i},{id:"violentmonkey",name:"Violentmonkey",weight:5,pattern:/violentmonkey/i}],AUTOMATION_GLOBALS=[{name:"webdriver",weight:10},{name:"__webdriver_evaluate",weight:10},{name:"__selenium_evaluate",weight:10},{name:"__webdriver_script_function",weight:10},{name:"__webdriver_script_func",weight:10},{name:"__webdriver_script_fn",weight:10},{name:"__fxdriver_evaluate",weight:10},{name:"__driver_unwrapped",weight:10},{name:"__webdriver_unwrapped",weight:10},{name:"__driver_evaluate",weight:10},{name:"__selenium_unwrapped",weight:10},{name:"__fxdriver_unwrapped",weight:10},{name:"_phantom",weight:9},{name:"__nightmare",weight:9},{name:"_selenium",weight:10},{name:"callSelenium",weight:10},{name:"callPhantom",weight:9},{name:"_Selenium_IDE_Recorder",weight:10},{name:"__playwright",weight:10},{name:"__puppeteer",weight:10},{name:"cdc_adoQpoasnfa76pfcZLmcfl_Array",weight:10},{name:"cdc_adoQpoasnfa76pfcZLmcfl_Promise",weight:10},{name:"cdc_adoQpoasnfa76pfcZLmcfl_Symbol",weight:10},{name:"iMacros",weight:8},{name:"GM_info",weight:5},{name:"GM_getValue",weight:5},{name:"GM_setValue",weight:5}],DOM_MARKERS=[{selector:"[data-mcp]",attribute:"data-mcp",pattern:/.+/,name:"MCP data attribute",weight:10},{selector:"[data-claude]",attribute:"data-claude",pattern:/.+/,name:"Claude data attribute",weight:10},{selector:"[data-anthropic]",attribute:"data-anthropic",pattern:/.+/,name:"Anthropic marker",weight:10},{selector:"[data-selenium]",attribute:"data-selenium",pattern:/.+/,name:"Selenium marker",weight:10},{selector:"[data-testid]",attribute:"data-testid",pattern:/^(selenium|cypress|playwright)/i,name:"Test framework ID",weight:7},{selector:"[data-cy]",attribute:"data-cy",pattern:/.+/,name:"Cypress marker",weight:7},{selector:"[data-automation]",attribute:"data-automation",pattern:/.+/,name:"Automation marker",weight:8},{selector:"[data-puppeteer]",attribute:"data-puppeteer",pattern:/.+/,name:"Puppeteer marker",weight:9}],collect=async()=>{const signals={timestamp:Date.now(),webdriver:detectWebdriver(),headless:detectHeadless(),extensions:await detectExtensions(),cometExtension:await detectCometExtension(),cometRuntime:detectCometRuntimeArtifacts(),perplexityNetwork:detectPerplexityNetwork(),globals:detectAutomationGlobals(),domMarkers:detectDomMarkers(),canvas:await collectCanvasFingerprint(),webgl:collectWebGLInfo(),navigator:collectNavigatorInfo()};return signals.score=calculateFingerprintScore(signals),signals};_exports.collect=collect;const detectWebdriver=()=>{const results={detected:!1,signals:[]};!0===navigator.webdriver&&(results.detected=!0,results.signals.push({name:"navigator.webdriver",value:!0,weight:10})),!0===navigator.webdriver&&!1===initialWebdriverState&&(results.detected=!0,results.signals.push({name:"webdriver.changed_mid_session",value:!0,weight:10}));try{const descriptor=Object.getOwnPropertyDescriptor(Navigator.prototype,"webdriver");if(descriptor&&descriptor.get){!1===descriptor.get.toString().includes("native code")&&(results.detected=!0,results.signals.push({name:"webdriver.getter.modified",value:!0,weight:9}))}}catch(e){results.signals.push({name:"webdriver.access.error",value:e.message,weight:3})}return results},detectHeadless=()=>{const results={detected:!1,signals:[]};0===navigator.plugins.length&&results.signals.push({name:"plugins.empty",value:!0,weight:6}),navigator.languages&&0!==navigator.languages.length||(results.detected=!0,results.signals.push({name:"languages.empty",value:!0,weight:7})),void 0===window.chrome&&/Chrome/.test(navigator.userAgent)&&(results.detected=!0,results.signals.push({name:"chrome.missing",value:!0,weight:8})),/HeadlessChrome|PhantomJS|SlimerJS/.test(navigator.userAgent)&&(results.detected=!0,results.signals.push({name:"useragent.headless",value:!0,weight:10})),0!==window.outerWidth&&0!==window.outerHeight||(results.detected=!0,results.signals.push({name:"window.dimensions.zero",value:!0,weight:8})),0!==screen.availWidth&&0!==screen.availHeight||results.signals.push({name:"screen.dimensions.zero",value:!0,weight:7});return void 0===(navigator.connection||navigator.mozConnection||navigator.webkitConnection)&&/Chrome/.test(navigator.userAgent)&&results.signals.push({name:"connection.missing",value:!0,weight:4}),navigator.permissions&&navigator.permissions.query({name:"notifications"}).then((result=>{"denied"===result.state&&results.signals.push({name:"permissions.notifications.denied",value:!0,weight:3})})).catch((()=>{})),results.detected=results.signals.some((s=>s.weight>=7)),results},detectExtensions=async()=>{const results={detected:[],signals:[]};for(const ext of KNOWN_EXTENSIONS){const elements=document.querySelectorAll(`[class*="${ext.id}"], [id*="${ext.id}"]`);elements.length>0&&(results.detected.push(ext.name),results.signals.push({name:`extension.dom.${ext.id}`,value:elements.length,weight:ext.weight}))}(void 0!==window.__MCP_READY||document.querySelector("[data-mcp-session]"))&&(results.detected.push("MCP Protocol"),results.signals.push({name:"mcp.protocol.detected",value:!0,weight:10})),(window.__CLAUDE_BROWSER_CONTEXT||window.__ANTHROPIC_SESSION)&&(results.detected.push("Claude Browser Context"),results.signals.push({name:"claude.context.detected",value:!0,weight:10}));const stylesheets=Array.from(document.styleSheets);for(const sheet of stylesheets)try{if(sheet.href&&sheet.href.startsWith("chrome-extension://"))for(const ext of KNOWN_EXTENSIONS)ext.pattern.test(sheet.href)&&(results.detected.push(ext.name),results.signals.push({name:`extension.stylesheet.${ext.id}`,value:sheet.href,weight:ext.weight}))}catch(e){}return results},detectAutomationGlobals=()=>{const results={detected:[],signals:[]};for(const global of AUTOMATION_GLOBALS)global.name in window&&(results.detected.push(global.name),results.signals.push({name:`global.${global.name}`,value:!0,weight:global.weight}));try{const docPropNames=Object.getOwnPropertyNames(document);for(const key of docPropNames)/^(\$?cdc_|_cdc_|\$chrome_asyncScriptInfo)/.test(key)&&(results.detected.push(key),results.signals.push({name:`document.cdp.${key}`,value:!0,weight:10}))}catch(e){}return results},detectDomMarkers=()=>{const results={detected:[],signals:[]};for(const marker of DOM_MARKERS){const elements=document.querySelectorAll(marker.selector);for(const el of elements){const value=el.getAttribute(marker.attribute);marker.pattern.test(value)&&(results.detected.push(marker.name),results.signals.push({name:`dom.${marker.attribute}`,value:value,weight:marker.weight}))}}return results},detectCometExtension=async()=>{const results={detected:!1,isAgentic:!1,signals:[]};try{"true"===sessionStorage.getItem("agentdetect_comet_detected")&&(results.detected=!0,results.signals.push({name:"comet.extension.cached",value:!0,weight:10}))}catch(e){}const scripts=document.querySelectorAll('script[src*="'+COMET_EXTENSION_ID+'"]');scripts.length>0&&(results.detected=!0,results.isAgentic=!0,results.signals.push({name:"comet.extension.script_injected",value:scripts[0].src,weight:10}));const links=document.querySelectorAll('link[href*="'+COMET_EXTENSION_ID+'"]');links.length>0&&(results.detected=!0,results.signals.push({name:"comet.extension.link_injected",value:links[0].href,weight:10}));try{for(const sheet of document.styleSheets)sheet.href&&sheet.href.includes(COMET_EXTENSION_ID)&&(results.detected=!0,results.signals.push({name:"comet.extension.stylesheet",value:sheet.href,weight:10}))}catch(e){}if(!results.detected){const probeResult=await probeExtensionResource();probeResult&&(results.detected=!0,results.signals.push({name:"comet.extension.resource_probe",value:probeResult,weight:10}))}if(results.detected)try{sessionStorage.setItem("agentdetect_comet_detected","true")}catch(e){}return results},probeExtensionResource=()=>new Promise((resolve=>{const baseUrl=`chrome-extension://${COMET_EXTENSION_ID}/`;let resolved=!1;const done=path=>{resolved||(resolved=!0,resolve(path))},probes=COMET_RESOURCE_PATHS.map((path=>new Promise((probeResolve=>{const img=new Image;img.onload=()=>{done(path),probeResolve(!0)},img.onerror=()=>{probeResolve(!1)},img.src=baseUrl+path}))));Promise.all(probes).then((()=>{done(null)})),setTimeout((()=>{done(null)}),1e3)})),detectPerplexityNetwork=()=>{const results={detected:!1,signals:[]};try{const entries=performance.getEntriesByType("resource");for(const entry of entries)if(/perplexity\.ai/i.test(entry.name)){results.detected=!0;const isAgent=/\/(agent|rest\/sse)/i.test(entry.name);results.signals.push({name:isAgent?"network.perplexity_agent":"network.perplexity_resource",value:entry.name,weight:isAgent?9:6})}}catch(e){}return results},detectCometRuntimeArtifacts=()=>{const results={detected:!1,signals:[]};try{const allElements=document.querySelectorAll("*");for(const el of allElements){if((el.getAttribute("style")||"").includes(COMET_EXTENSION_ID)){results.detected=!0,results.signals.push({name:"comet.runtime.inline_style",value:el.tagName,weight:10});break}}}catch(e){}try{const scripts=document.querySelectorAll("script");for(const script of scripts){const src=script.src||"";src.includes("chrome-extension://")&&(src.includes(COMET_EXTENSION_ID)||src.includes("perplexity")||src.includes("comet"))&&(results.detected=!0,results.signals.push({name:"comet.runtime.script",value:src,weight:10}))}}catch(e){}const cometGlobals=["__comet__","__perplexity__","__pplx__","cometAgent","perplexityAgent"];for(const name of cometGlobals)name in window&&(results.detected=!0,results.signals.push({name:"comet.runtime.global",value:name,weight:10}));return results},collectCanvasFingerprint=async()=>{const results={hash:null,anomalies:[]};try{const canvas=document.createElement("canvas");canvas.width=200,canvas.height=50;const ctx=canvas.getContext("2d");ctx.textBaseline="top",ctx.font="14px Arial",ctx.fillStyle="#f60",ctx.fillRect(125,1,62,20),ctx.fillStyle="#069",ctx.fillText("Agent Detection Test",2,15),ctx.fillStyle="rgba(102, 204, 0, 0.7)",ctx.fillText("Canvas Fingerprint",4,17);const dataUrl=canvas.toDataURL();results.hash=await hashString(dataUrl),dataUrl.length<1e3&&results.anomalies.push({name:"canvas.data.short",weight:6})}catch(e){results.anomalies.push({name:"canvas.error",value:e.message,weight:5})}return results},collectWebGLInfo=()=>{const results={vendor:null,renderer:null,anomalies:[]};try{const canvas=document.createElement("canvas"),gl=canvas.getContext("webgl")||canvas.getContext("experimental-webgl");if(gl){const debugInfo=gl.getExtension("WEBGL_debug_renderer_info");if(debugInfo){results.vendor=gl.getParameter(debugInfo.UNMASKED_VENDOR_WEBGL),results.renderer=gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL);const headlessRenderers=["SwiftShader","llvmpipe","Mesa","Software"];for(const hr of headlessRenderers)results.renderer&&results.renderer.includes(hr)&&results.anomalies.push({name:`webgl.renderer.${hr.toLowerCase()}`,value:results.renderer,weight:8})}}else results.anomalies.push({name:"webgl.unavailable",weight:5})}catch(e){results.anomalies.push({name:"webgl.error",value:e.message,weight:3})}return results},collectNavigatorInfo=()=>({userAgent:navigator.userAgent,platform:navigator.platform,hardwareConcurrency:navigator.hardwareConcurrency,deviceMemory:navigator.deviceMemory,maxTouchPoints:navigator.maxTouchPoints,languages:navigator.languages?[...navigator.languages]:[],cookieEnabled:navigator.cookieEnabled,doNotTrack:navigator.doNotTrack,pluginCount:navigator.plugins.length}),calculateFingerprintScore=signals=>{var _signals$cometExtensi,_signals$cometRuntime,_signals$perplexityNe;let totalWeight=0,maxWeight=0;const allSignals=[...signals.webdriver.signals||[],...signals.headless.signals||[],...signals.extensions.signals||[],...(null===(_signals$cometExtensi=signals.cometExtension)||void 0===_signals$cometExtensi?void 0:_signals$cometExtensi.signals)||[],...(null===(_signals$cometRuntime=signals.cometRuntime)||void 0===_signals$cometRuntime?void 0:_signals$cometRuntime.signals)||[],...(null===(_signals$perplexityNe=signals.perplexityNetwork)||void 0===_signals$perplexityNe?void 0:_signals$perplexityNe.signals)||[],...signals.globals.signals||[],...signals.domMarkers.signals||[],...signals.canvas.anomalies||[],...signals.webgl.anomalies||[]];for(const signal of allSignals)totalWeight+=signal.weight||0,maxWeight+=10;if(0===maxWeight)return 0;const rawScore=totalWeight/Math.max(maxWeight,50)*100;return Math.min(100,Math.round(rawScore))},hashString=async str=>{const data=(new TextEncoder).encode(str),hashBuffer=await crypto.subtle.digest("SHA-256",data);return Array.from(new Uint8Array(hashBuffer)).map((b=>b.toString(16).padStart(2,"0"))).join("")};var _default={collect:collect,KNOWN_EXTENSIONS:KNOWN_EXTENSIONS,AUTOMATION_GLOBALS:AUTOMATION_GLOBALS};return _exports.default=_default,_exports.default}));

//# sourceMappingURL=fingerprint.min.js.map