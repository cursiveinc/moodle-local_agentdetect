{"version":3,"file":"injection.min.js","sources":["../src/injection.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Injection detection module.\n *\n * Uses MutationObserver to detect elements injected by browser extensions,\n * particularly AI helper tools, homework solvers, and answer providers.\n *\n * This catches human-driven AI assistance where students use extension UI\n * (sidebars, \"solve\" buttons, floating helpers) rather than automated agents.\n *\n * @module     local_agentdetect/injection\n * @copyright  2024 Your Institution\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport Log from 'core/log';\n\n/**\n * Suspicious text patterns that indicate AI/homework helper UI.\n * These are commonly found in extension-injected buttons and panels.\n *\n * @type {Array<{pattern: RegExp, name: string, weight: number}>}\n */\nconst SUSPICIOUS_TEXT_PATTERNS = [\n    // Direct answer/solve buttons - must be specific to avoid Moodle's own UI.\n    // Avoid generic \"answer\" or \"solve\" which appear in quiz feedback.\n    {pattern: /\\b(get\\s+answer|show\\s+answer|reveal\\s+answer|find\\s+answer)\\b/i, name: 'get_answer', weight: 9},\n    {pattern: /\\b(solve\\s+this|solve\\s+for\\s+me|auto\\s*solve)\\b/i, name: 'solve_button', weight: 8},\n    {pattern: /\\b(step.by.step\\s+solution)\\b/i, name: 'explain_button', weight: 6},\n\n    // AI assistant triggers - specific phrases.\n    {pattern: /\\b(ask\\s+(ai|gpt|chatgpt|claude|copilot|gemini|bard))\\b/i, name: 'ask_ai', weight: 9},\n    {pattern: /\\b(ai\\s+(help|assist|tutor|helper))\\b/i, name: 'ai_help', weight: 8},\n    {pattern: /\\b(generate\\s+answer|write\\s+for\\s+me|ai\\s+write)\\b/i, name: 'generate', weight: 7},\n\n    // Known cheating services - brand names.\n    {pattern: /\\b(chegg|course\\s*hero|brainly|bartleby|studocu)\\b/i, name: 'known_service', weight: 10},\n    {pattern: /\\b(symbolab|mathway|photomath|wolfram\\s*alpha)\\b/i, name: 'math_solver', weight: 8},\n    {pattern: /\\b(quillbot|scribbr)\\b/i, name: 'writing_helper', weight: 5},\n];\n\n/**\n * Suspicious element patterns (classes, IDs, attributes).\n *\n * @type {Array<{pattern: RegExp, attribute: string, name: string, weight: number}>}\n */\nconst SUSPICIOUS_ELEMENT_PATTERNS = [\n    // Common AI extension patterns - must start with these to avoid false positives.\n    {pattern: /^chatgpt/i, attribute: 'class', name: 'chatgpt_class', weight: 9},\n    {pattern: /^chatgpt/i, attribute: 'id', name: 'chatgpt_id', weight: 9},\n    {pattern: /^openai/i, attribute: 'class', name: 'openai_class', weight: 9},\n    {pattern: /^openai/i, attribute: 'id', name: 'openai_id', weight: 9},\n    {pattern: /^gpt-/i, attribute: 'class', name: 'gpt_class', weight: 9},\n    {pattern: /^claude-/i, attribute: 'class', name: 'claude_class', weight: 9},\n    {pattern: /^gemini-/i, attribute: 'class', name: 'gemini_class', weight: 9},\n\n    // Extension-specific patterns - brand names only.\n    {pattern: /^chegg/i, attribute: 'class', name: 'chegg', weight: 10},\n    {pattern: /^chegg/i, attribute: 'id', name: 'chegg', weight: 10},\n    {pattern: /^brainly/i, attribute: 'class', name: 'brainly', weight: 10},\n    {pattern: /^brainly/i, attribute: 'id', name: 'brainly', weight: 10},\n    {pattern: /^coursehero/i, attribute: 'class', name: 'coursehero', weight: 10},\n    {pattern: /^quizlet/i, attribute: 'class', name: 'quizlet', weight: 8},\n    {pattern: /^bartleby/i, attribute: 'class', name: 'bartleby', weight: 10},\n    {pattern: /^studocu/i, attribute: 'class', name: 'studocu', weight: 10},\n\n    // Perplexity Comet agent patterns.\n    {pattern: /^comet/i, attribute: 'class', name: 'comet_class', weight: 9},\n    {pattern: /^comet/i, attribute: 'id', name: 'comet_id', weight: 9},\n    {pattern: /^perplexity/i, attribute: 'class', name: 'perplexity_class', weight: 9},\n    {pattern: /^perplexity/i, attribute: 'id', name: 'perplexity_id', weight: 9},\n    {pattern: /npclhjbddhklpbnacpjloidibaggcgon/, attribute: 'src', name: 'comet_agent_src', weight: 10},\n    {pattern: /npclhjbddhklpbnacpjloidibaggcgon/, attribute: 'href', name: 'comet_agent_href', weight: 10},\n\n    // Extension resource URLs - definitive signal.\n    {pattern: /chrome-extension:\\/\\//i, attribute: 'src', name: 'chrome_ext_src', weight: 7},\n    {pattern: /moz-extension:\\/\\//i, attribute: 'src', name: 'moz_ext_src', weight: 7},\n];\n\n/**\n * Elements that look like injected floating UI (fixed/absolute positioned overlays).\n *\n * @type {Object}\n */\nconst FLOATING_UI_INDICATORS = {\n    positions: ['fixed', 'absolute'],\n    minSize: 50, // Minimum width/height to consider\n    maxZIndex: 9000, // High z-index suggests overlay\n};\n\n/**\n * Storage for detected injections.\n *\n * @type {Object}\n */\nconst detectionStore = {\n    injectedElements: [],\n    suspiciousText: [],\n    floatingUI: [],\n    chromeExtensionResources: [],\n    startTime: Date.now(),\n};\n\n/**\n * MutationObserver instance.\n *\n * @type {MutationObserver|null}\n */\nlet observer = null;\n\n/**\n * Whether monitoring is active.\n *\n * @type {boolean}\n */\nlet isMonitoring = false;\n\n/**\n * Debug mode flag.\n *\n * @type {boolean}\n */\nlet debugMode = false;\n\n/**\n * Start monitoring for injected content.\n *\n * @param {Object} options Configuration options.\n * @param {boolean} options.debug Enable debug logging.\n * @returns {void}\n */\nexport const startMonitoring = (options = {}) => {\n    if (isMonitoring) {\n        return;\n    }\n\n    debugMode = options.debug || false;\n    isMonitoring = true;\n    detectionStore.startTime = Date.now();\n\n    // Scan existing DOM first.\n    scanExistingDOM();\n\n    // Set up MutationObserver for future changes.\n    observer = new MutationObserver(handleMutations);\n    observer.observe(document.body, {\n        childList: true,\n        subtree: true,\n        attributes: true,\n        attributeFilter: ['class', 'id', 'src', 'href', 'style', 'data-comet', 'data-perplexity'],\n    });\n\n    if (debugMode) {\n        Log.debug('[AgentDetect/Injection] Monitoring started');\n    }\n};\n\n/**\n * Stop monitoring for injected content.\n *\n * @returns {void}\n */\nexport const stopMonitoring = () => {\n    if (!isMonitoring) {\n        return;\n    }\n\n    if (observer) {\n        observer.disconnect();\n        observer = null;\n    }\n\n    isMonitoring = false;\n\n    if (debugMode) {\n        Log.debug('[AgentDetect/Injection] Monitoring stopped');\n    }\n};\n\n/**\n * Scan the existing DOM for suspicious elements.\n * Called once at startup to catch elements already present.\n *\n * @returns {void}\n */\nconst scanExistingDOM = () => {\n    // Scan all elements for suspicious patterns.\n    const allElements = document.body.querySelectorAll('*');\n    for (const element of allElements) {\n        analyzeElement(element, 'initial_scan');\n    }\n\n    // Look for chrome-extension:// resources.\n    scanExtensionResources();\n\n    if (debugMode) {\n        Log.debug('[AgentDetect/Injection] Initial scan complete', {\n            injectedElements: detectionStore.injectedElements.length,\n            suspiciousText: detectionStore.suspiciousText.length,\n            floatingUI: detectionStore.floatingUI.length,\n        });\n    }\n};\n\n/**\n * Handle DOM mutations.\n *\n * @param {MutationRecord[]} mutations List of mutations.\n * @returns {void}\n */\nconst handleMutations = (mutations) => {\n    for (const mutation of mutations) {\n        if (mutation.type === 'childList') {\n            // New nodes added.\n            for (const node of mutation.addedNodes) {\n                if (node.nodeType === Node.ELEMENT_NODE) {\n                    analyzeElement(node, 'mutation_added');\n\n                    // Comet-specific: detect extension content script or resource injection.\n                    const src = node.getAttribute ? (node.getAttribute('src') || '') : '';\n                    const href = node.getAttribute ? (node.getAttribute('href') || '') : '';\n                    const resourceUrl = src || href;\n\n                    if (resourceUrl.includes('npclhjbddhklpbnacpjloidibaggcgon') ||\n                        resourceUrl.includes('chrome-extension://')) {\n                        const isComet = resourceUrl.includes('npclhjbddhklpbnacpjloidibaggcgon');\n                        detectionStore.injectedElements.push({\n                            timestamp: Date.now(),\n                            source: isComet ? 'comet_extension_injection' : 'chrome_extension_injection',\n                            tagName: node.tagName,\n                            id: node.id || null,\n                            className: node.className || null,\n                            findings: [{\n                                type: isComet ? 'comet_agentic' : 'extension',\n                                name: isComet ? 'comet_overlay_js' : 'chrome_ext_injection',\n                                value: resourceUrl,\n                                weight: 10,\n                            }],\n                        });\n                        if (debugMode) {\n                            Log.debug('[AgentDetect/Injection] Extension resource injected',\n                                node.tagName, resourceUrl);\n                        }\n                    }\n\n                    // Check for elements with shadow roots (common for extension UI).\n                    if (node.shadowRoot) {\n                        detectionStore.injectedElements.push({\n                            timestamp: Date.now(),\n                            source: 'shadow_dom_injection',\n                            tagName: node.tagName,\n                            id: node.id || null,\n                            className: node.className || null,\n                            findings: [{\n                                type: 'shadow_dom',\n                                name: 'injected_shadow_root',\n                                weight: 7,\n                            }],\n                        });\n                    }\n\n                    // Also scan children of added nodes.\n                    const children = node.querySelectorAll ? node.querySelectorAll('*') : [];\n                    for (const child of children) {\n                        analyzeElement(child, 'mutation_added_child');\n                    }\n                }\n            }\n        } else if (mutation.type === 'attributes') {\n            // Attribute changed.\n            analyzeElement(mutation.target, 'mutation_attribute');\n        }\n    }\n};\n\n/**\n * Analyze a single element for suspicious patterns.\n *\n * @param {Element} element Element to analyze.\n * @param {string} source How this element was found.\n * @returns {void}\n */\nconst analyzeElement = (element, source) => {\n    if (!element || !element.tagName) {\n        return;\n    }\n\n    // Skip Moodle's own elements (basic heuristic).\n    if (isMoodleElement(element)) {\n        return;\n    }\n\n    const findings = [];\n\n    // Check element attributes against suspicious patterns.\n    for (const pattern of SUSPICIOUS_ELEMENT_PATTERNS) {\n        const attrValue = element.getAttribute(pattern.attribute);\n        if (attrValue && pattern.pattern.test(attrValue)) {\n            findings.push({\n                type: 'element_pattern',\n                name: pattern.name,\n                attribute: pattern.attribute,\n                value: attrValue,\n                weight: pattern.weight,\n            });\n        }\n    }\n\n    // Check text content for suspicious patterns.\n    const textContent = element.textContent?.trim().substring(0, 200) || '';\n    if (textContent && element.children.length === 0) { // Only leaf nodes\n        for (const pattern of SUSPICIOUS_TEXT_PATTERNS) {\n            if (pattern.pattern.test(textContent)) {\n                findings.push({\n                    type: 'text_pattern',\n                    name: pattern.name,\n                    text: textContent.substring(0, 50),\n                    weight: pattern.weight,\n                });\n            }\n        }\n    }\n\n    // Check for floating UI (fixed/absolute positioned overlays).\n    const floatingInfo = checkFloatingUI(element);\n    if (floatingInfo) {\n        findings.push({\n            type: 'floating_ui',\n            name: 'injected_overlay',\n            ...floatingInfo,\n            weight: 6,\n        });\n    }\n\n    // Check for shadow DOM (common in extension-injected UI).\n    if (element.shadowRoot) {\n        findings.push({\n            type: 'shadow_dom',\n            name: 'injected_shadow_root',\n            weight: 7,\n        });\n    }\n\n    // Store findings.\n    if (findings.length > 0) {\n        const detection = {\n            timestamp: Date.now(),\n            source: source,\n            tagName: element.tagName,\n            id: element.id || null,\n            className: element.className || null,\n            findings: findings,\n        };\n\n        detectionStore.injectedElements.push(detection);\n\n        if (debugMode) {\n            Log.debug('[AgentDetect/Injection] Suspicious element detected', detection);\n        }\n    }\n};\n\n/**\n * Check if an element is a floating UI overlay (likely injected).\n *\n * @param {Element} element Element to check.\n * @returns {Object|null} Floating UI info or null.\n */\nconst checkFloatingUI = (element) => {\n    const style = window.getComputedStyle(element);\n    const position = style.position;\n\n    if (!FLOATING_UI_INDICATORS.positions.includes(position)) {\n        return null;\n    }\n\n    const rect = element.getBoundingClientRect();\n    const zIndex = parseInt(style.zIndex, 10) || 0;\n\n    // Must be visible and reasonably sized.\n    if (rect.width < FLOATING_UI_INDICATORS.minSize ||\n        rect.height < FLOATING_UI_INDICATORS.minSize) {\n        return null;\n    }\n\n    // High z-index suggests overlay.\n    if (zIndex >= FLOATING_UI_INDICATORS.maxZIndex) {\n        return {\n            position: position,\n            zIndex: zIndex,\n            width: rect.width,\n            height: rect.height,\n        };\n    }\n\n    return null;\n};\n\n/**\n * Basic check if element appears to be part of Moodle.\n *\n * @param {Element} element Element to check.\n * @returns {boolean} True if likely a Moodle element.\n */\nconst isMoodleElement = (element) => {\n    const className = element.className?.toString() || '';\n    const id = element.id || '';\n\n    // Common Moodle/Bootstrap/TinyMCE class prefixes - these are NOT injected.\n    const moodlePatterns = [\n        // Moodle core.\n        /^(mod-|block-|course-|quiz-|assign-|forum-|page-)/i,\n        /^(moodle|mdl-|m-)/i,\n        /^(nav|navbar|footer|header|drawer)/i,\n        /^(activity|section|content)/i,\n        /^(user|profile|grade)/i,\n\n        // Bootstrap (used by Moodle).\n        /^(btn|alert|card|modal|dropdown|collapse|form-|input-|list-)/i,\n        /^(container|row|col-|d-|p-|m-|text-|bg-|border-)/i,\n\n        // Font Awesome icons.\n        /^(fa-|fa |fas |far |fab |icon)/i,\n\n        // TinyMCE editor (Moodle's text editor) - NOT an AI sidebar!\n        /^(tox-|tox |mce-|tiny)/i,\n\n        // Moodle question/quiz UI.\n        /^(que|qn|answer|formulation|outcome|feedback|rightanswer)/i,\n        /^(submitbtns|im-controls)/i,\n\n        // Atto editor.\n        /^(atto|editor_atto)/i,\n\n        // YUI (legacy Moodle).\n        /^(yui|yui3)/i,\n    ];\n\n    for (const pattern of moodlePatterns) {\n        if (pattern.test(className) || pattern.test(id)) {\n            return true;\n        }\n    }\n\n    // Check for Moodle data attributes.\n    if (element.hasAttribute('data-region') ||\n        element.hasAttribute('data-action') ||\n        element.hasAttribute('data-for') ||\n        element.hasAttribute('data-contextid')) {\n        return true;\n    }\n\n    return false;\n};\n\n/**\n * Scan for chrome-extension:// or moz-extension:// resources.\n *\n * @returns {void}\n */\nconst scanExtensionResources = () => {\n    // Check images.\n    const images = document.querySelectorAll('img[src^=\"chrome-extension://\"], img[src^=\"moz-extension://\"]');\n    for (const img of images) {\n        detectionStore.chromeExtensionResources.push({\n            type: 'image',\n            src: img.src,\n            timestamp: Date.now(),\n        });\n    }\n\n    // Check iframes.\n    const iframes = document.querySelectorAll(\n        'iframe[src^=\"chrome-extension://\"], iframe[src^=\"moz-extension://\"]'\n    );\n    for (const iframe of iframes) {\n        detectionStore.chromeExtensionResources.push({\n            type: 'iframe',\n            src: iframe.src,\n            timestamp: Date.now(),\n        });\n    }\n\n    // Check stylesheets.\n    for (const sheet of document.styleSheets) {\n        try {\n            if (sheet.href &&\n                (sheet.href.startsWith('chrome-extension://') || sheet.href.startsWith('moz-extension://'))) {\n                detectionStore.chromeExtensionResources.push({\n                    type: 'stylesheet',\n                    src: sheet.href,\n                    timestamp: Date.now(),\n                });\n            }\n        } catch (e) {\n            // Cross-origin stylesheet, can't inspect.\n        }\n    }\n};\n\n/**\n * Analyze collected injection data and return results.\n *\n * @returns {Object} Analysis results with score and signals.\n */\nexport const analyze = () => {\n    const results = {\n        timestamp: Date.now(),\n        duration: Date.now() - detectionStore.startTime,\n        detectionCounts: {\n            injectedElements: detectionStore.injectedElements.length,\n            extensionResources: detectionStore.chromeExtensionResources.length,\n        },\n        signals: [],\n        score: 0,\n    };\n\n    // Aggregate signals from detected elements.\n    const signalMap = new Map();\n\n    for (const detection of detectionStore.injectedElements) {\n        for (const finding of detection.findings) {\n            const key = `${finding.type}.${finding.name}`;\n            if (!signalMap.has(key)) {\n                signalMap.set(key, {\n                    name: key,\n                    count: 0,\n                    maxWeight: finding.weight,\n                    examples: [],\n                });\n            }\n            const signal = signalMap.get(key);\n            signal.count++;\n            signal.maxWeight = Math.max(signal.maxWeight, finding.weight);\n            if (signal.examples.length < 3) {\n                signal.examples.push(finding.text || finding.value || detection.tagName);\n            }\n        }\n    }\n\n    // Add extension resource signals.\n    if (detectionStore.chromeExtensionResources.length > 0) {\n        signalMap.set('extension.resources', {\n            name: 'extension.resources',\n            count: detectionStore.chromeExtensionResources.length,\n            maxWeight: 7,\n            examples: detectionStore.chromeExtensionResources.slice(0, 3).map((r) => r.type),\n        });\n    }\n\n    // Convert to array and calculate score.\n    results.signals = Array.from(signalMap.values());\n    results.score = calculateInjectionScore(results.signals);\n\n    return results;\n};\n\n/**\n * Calculate injection detection score.\n *\n * @param {Array} signals Detected signals.\n * @returns {number} Score from 0-100.\n */\nconst calculateInjectionScore = (signals) => {\n    if (signals.length === 0) {\n        return 0;\n    }\n\n    let totalWeight = 0;\n\n    for (const signal of signals) {\n        // Weight increases with count but with diminishing returns.\n        const countMultiplier = Math.min(signal.count, 5);\n        totalWeight += signal.maxWeight * (1 + (countMultiplier - 1) * 0.2);\n    }\n\n    // Normalize to 0-100 scale.\n    // Max reasonable score would be ~5 signals at weight 10 = 50.\n    const normalized = (totalWeight / 50) * 100;\n    return Math.min(100, Math.round(normalized));\n};\n\n/**\n * Get raw detection data for debugging.\n *\n * @returns {Object} Detection store data.\n */\nexport const getRawData = () => {\n    return {\n        ...detectionStore,\n        isMonitoring,\n    };\n};\n\n/**\n * Reset all collected data.\n *\n * @returns {void}\n */\nexport const reset = () => {\n    detectionStore.injectedElements = [];\n    detectionStore.suspiciousText = [];\n    detectionStore.floatingUI = [];\n    detectionStore.chromeExtensionResources = [];\n    detectionStore.startTime = Date.now();\n};\n\nexport default {\n    startMonitoring,\n    stopMonitoring,\n    analyze,\n    getRawData,\n    reset,\n};\n"],"names":["SUSPICIOUS_TEXT_PATTERNS","pattern","name","weight","SUSPICIOUS_ELEMENT_PATTERNS","attribute","FLOATING_UI_INDICATORS","positions","minSize","maxZIndex","detectionStore","injectedElements","suspiciousText","floatingUI","chromeExtensionResources","startTime","Date","now","observer","isMonitoring","debugMode","startMonitoring","options","debug","scanExistingDOM","MutationObserver","handleMutations","observe","document","body","childList","subtree","attributes","attributeFilter","stopMonitoring","disconnect","allElements","querySelectorAll","element","analyzeElement","scanExtensionResources","length","mutations","mutation","type","node","addedNodes","nodeType","Node","ELEMENT_NODE","src","getAttribute","href","resourceUrl","includes","isComet","push","timestamp","source","tagName","id","className","findings","value","shadowRoot","children","child","target","isMoodleElement","attrValue","test","textContent","trim","substring","text","floatingInfo","checkFloatingUI","detection","style","window","getComputedStyle","position","rect","getBoundingClientRect","zIndex","parseInt","width","height","toString","moodlePatterns","hasAttribute","images","img","iframes","iframe","sheet","styleSheets","startsWith","e","analyze","results","duration","detectionCounts","extensionResources","signals","score","signalMap","Map","finding","key","has","set","count","maxWeight","examples","signal","get","Math","max","slice","map","r","Array","from","values","calculateInjectionScore","totalWeight","countMultiplier","min","normalized","round","getRawData","reset"],"mappings":"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"}